
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js and the geo projection plugin -->
<script src="http://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
   
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<!-- Load Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>

<!-- Create an element where the map will take place -->
<div id="mapid"></div>

<div class="container">

<h2 id="Hotel_Name_display" ></h2>

<h3 id="Hotel_Score_display"></h3>

<p id="Hotel_Address_display"></p>

</div>


<style>
#mapid { height: 600px; }
.legend { text-align: left; line-height: 28px; color: #555; } .legend i { width: 28px; height: 28px; float: left; margin-right: 8px; opacity: 0.7; }

.info {
    padding: 16px 18px;
    font: 14px/28px Arial, Helvetica, sans-serif;
    background: white;
    background: #ffffff;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
svg {pointer-events:all;}

</style>

<script type='text/javascript' src='data/Hotel_data_test.json'></script>

<script>
// mapid is the id of the div where the map will appear
var map = L.map( 'mapid', {
  center: [46.0, 5.0],
  minZoom: 2,
  zoom: 5
})

// Add a tile to the map = a background. Comes from OpenStreetmap
L.tileLayer(
    'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
    maxZoom: 19,
    }).addTo(map);

// Add a svg layer to the map
L.svg().addTo(map);
var getColor  = function(Average_Score){
  return ("rgb("+(-Average_Score+10) * (-Average_Score+10)*30 +", " + (-Average_Score+5) * (-Average_Score+5)*20 + ",0)")
}
//Add tooltip 
var Tooltip = d3.select("#mapid")
      .append("div")
	    .attr("id","mytooltip")
      .attr("class", "leaflet-pane leaflet-tooltip-pane")
      .style("opacity", 1)
      .style("background-color", "yellow")
      .style("border", "solid")
      .style("border-width", "0px")
      .style("border-radius", "5px")
      .style("padding", "5px")
	  
var in_circle = function(d) {
      Tooltip.style("opacity", 1)
	    d3.select(this)
   	    .style("fill", "purple");
    }	
var out_circle = function(d) {
      Tooltip.style("opacity", 0)
  	  d3.select(this)
        .style("fill", getColor(d.Average_Score));
    }	
var showme = function(d) {
  
  d3.select(this)
   	    .style("fill", "purple")
        .style("cursor", "pointer");
  Tooltip
        .html("Hotel Name: " + d.Hotel_Name.toString() + "<br>" + "Score: " + d.Average_Score + "<br>" + "Adress: " + d.Hotel_Address.toString())
	      // .style("left", (map.latLngToLayerPoint(d.Coordinates).x) + "px")
	    	// .style("top", (map.latLngToLayerPoint(d.Coordinates).y) + "px")
        .style("left", "0px")
	    	.style("top",  "520px")
        .style("background-color",  getColor(d.Average_Score));
    } 

   

    //onclick change the other sub graphs 
    var click_hotel = function(d) {
      map.setView(d.Coordinates, map.getZoom()+2);
  console.log(d);
    document.getElementById("Hotel_Name_display").innerHTML= ("<br>"+"Hotel Name: " + d.Hotel_Name.toString() )
  //  document.getElementById("hotel_info").innerHTML = ("Hotel Name: " + d.Hotel_Name.toString() + "<br>" + "Score: " + d.Average_Score + "&#09"+"  Total Reviews: "+ d.Total_Number_of_Reviews.toString()+ "<br>" + "Adress: " + d.Hotel_Address.toString());
    document.getElementById("Hotel_Score_display").innerHTML = ("Total Reviews: "+ d.Total_Number_of_Reviews.toString()+"&#09"+  " Average Score: " + d.Average_Score )
    document.getElementById("Hotel_Address_display").innerHTML = "Adress: " + d.Hotel_Address.toString()+ "<hr>"

    }	

// Select the svg area and add circles:
d3.select("#mapid")
  .select("svg")
  .selectAll("myCircles")
  .data(Hotel_data_test)
  .enter()
  .append("circle")
    .attr("cx", function(d){  return map.latLngToLayerPoint(d.Coordinates).x })
    .attr("cy", function(d){  return map.latLngToLayerPoint(d.Coordinates).y })
    .attr("r", function(d){  return Math.max(d.Total_Number_of_Reviews/500,5)})
    .style("fill", function(d){ return  getColor(d.Average_Score) })
    .attr("stroke", "yellow")
    .attr("stroke-width", 0.1)
    .attr("fill-opacity", .6)
    .on("mousemove", showme)
    .on("mouseover",in_circle)
    .on("mouseleave",out_circle)
    .on("click", click_hotel);
    
    
// Function that update circle position if something change
function update() {
  d3.selectAll("circle")
    .attr("cx", function(d){ return map.latLngToLayerPoint(d.Coordinates).x })
    .attr("cy", function(d){ return map.latLngToLayerPoint(d.Coordinates).y })
}



// If the user change the map (zoom or drag), I update circle position:
map.on("moveend", update)



var legend = L.control({position: 'bottomright'});

legend.onAdd = function (map) {

  var div = L.DomUtil.create('div', 'info legend'),
    grades = [ 5, 6,6.5, 7,7.5,8,9,10],
    labels = [],
    from, to;

  for (var i = 0; i < grades.length; i++) {
    from = grades[i];
    to = grades[i + 1];

    labels.push(
      '<i style="background:' + getColor(from + 1) + '"></i> ' +
      from + (to ? '&ndash;' + to : ''));
  }

  div.innerHTML = labels.join('<br>');
  return div;
};


legend.addTo(map);




var legendSize = L.control({position: 'topright'});

legendSize.onAdd = function (map) {

var div = L.DomUtil.create('div', 'info legend')

// append the svg object to the body of the page
var height = 100
var width = 100
var svg = d3.select(div)
  .append("svg")
    .attr("width", width)
    .attr("height", height)

// The scale you use for bubble size
var size = d3.scaleSqrt()
  .domain([1, 100])  // What's in the data, let's say it is percentage
  .range([1, 100])  // Size in pixel

// Add legend: circles
var valuesToShow = [10, 50, 100]
var xCircle = 23
var xLabel = 38
var yCircle = 33
svg
  .selectAll("legend")
  .data(valuesToShow)
  .enter()
  .append("circle")
    .attr("cx", xCircle)
    .attr("cy", function(d){ return yCircle - size(d) } )
    .attr("r", function(d){ return size(d)/10 })
    .style("fill", "none")
    .attr("stroke", "black")

// Add legend: segments
svg
  .selectAll("legend")
  .data(valuesToShow)
  .enter()
  .append("line")
    .attr('x1', function(d){ return xCircle + size(d) } )
    .attr('x2', xLabel)
    .attr('y1', function(d){ return yCircle - size(d) } )
    .attr('y2', function(d){ return yCircle - size(d) } )
    .attr('stroke', 'black')
    .style('stroke-dasharray', ('2,2'))

// Add legend: labels
svg
  .selectAll("legend")
  .data(valuesToShow)
  .enter()
  .append("text")
    .attr('x', xLabel)
    .attr('y', function(d){ return yCircle - size(d)} )
    .text( function(d){ return d } )
    .style("font-size", 10)
    .attr('alignment-baseline', 'middle')

  return div;
};


legendSize.addTo(map);







</script>